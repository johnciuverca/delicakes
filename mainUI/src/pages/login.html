<!DOCTYPE html>
<html lang="en">

<head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Login - Delicakes</title>
      <link rel="stylesheet" href="../style/style.css">
      <link rel="stylesheet" href="../style/login.css">
</head>

<body>
      <div class="container">
            <header class="header-flex">
                  <h1>
                        <a href="../" class="home-link" style="color:inherit;text-decoration:none;">Delicakes
                              <span class="tooltip">Home</span>
                        </a>
                  </h1>
                  <div class="social-icons">
                        <a href="https://instagram.com" target="_blank" aria-label="Instagram">
                              <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/instagram.svg"
                                    alt="Instagram" width="32" height="32">
                        </a>
                        <a href="https://facebook.com" target="_blank" aria-label="Facebook">
                              <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/facebook.svg"
                                    alt="Facebook" width="32" height="32">
                        </a>
                        <a href="https://tiktok.com" target="_blank" aria-label="TikTok">
                              <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/tiktok.svg"
                                    alt="TikTok" width="32" height="32">
                        </a>
                  </div>
            </header>
            <nav class="navbar">
                  <div class="left-links">
                        <a href="/pages/recipes.html">Recipes</a>
                        <a href="/pages/about.html">About</a>
                  </div>
                  <div class="right-links">
                        <a href="/pages/contact.html">Contact</a>
                        <a href="/expense-tracker">Expense-Tracker</a>
                  </div>
            </nav>
            <div class="main">
                  <form class="login-form">
                        <div class="form-container">
                              <label for="role"><b>Role</b></label>
                              <select name="role" id="role">
                                    <option value="admin">Admin</option>
                                    <option value="audit">Audit</option>
                              </select>

                              <label for="psw"><b>Password</b></label>
                              <input type="password" placeholder="Enter Password" name="psw">

                              <button type="submit">Login</button>
                        </div>
                  </form>
            </div>
      </div>
      <script>
            const loginForm = document.querySelector('.login-form');

            loginForm.addEventListener('submit', function (event) {
                  event.preventDefault();

                  const role = document.getElementById('role').value;
                  const inputPassword = loginForm.psw.value;

                  console.log('Role:', role);
                  console.log('Password:', inputPassword);

                  const response = fetch('/expense-tracker', {
                        method: 'POST',
                        headers: {
                              'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                              role: role,
                              psw: inputPassword
                        })
                  }).then(res => {
                        if (!res.redirected && res.status === 200) {
                              // Set auth cookie
                              res.json().then(data => {
                                    document.cookie = `auth=${data.authCookie}; path=/`;
                                    window.location.href = '/expense-tracker';
                              });
                        } else if (res.status === 401) {
                              alert('Unauthorized: Incorrect password.');
                        } else {
                              alert('Login failed. Please try again.');
                        }
                  });
            });
      </script>
</body>

</html>